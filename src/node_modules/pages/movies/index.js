import React, { Fragment, useEffect } from 'react';
import { useSelector, shallowEqual } from 'react-redux';

import Header from 'components/header';
import useActions from 'hooks/useActions';
import fetchMoviesActionCreator from 'actions/movies';
import fetchCategoriesActionCreator from 'actions/categories';
import { getCategories } from 'selectors';
import Movie from './components/movie';

import './movies.scss';

const Movies = () => {

    const [fetchMovies, fetchCategories] = useActions([fetchMoviesActionCreator, fetchCategoriesActionCreator]);

    useEffect(() => {
        fetchMovies();
        fetchCategories();
    }, [fetchMovies, fetchCategories]);

    const movies = useSelector(({ movies }) => movies.all, shallowEqual);
    const categories = useSelector(getCategories, shallowEqual);

    return (
        <Fragment>
            <Header />
            <main className='container'>
                <section className='movies'>
                    {movies && movies.map((movie) => <Movie movie={movie} categories={categories} key={movie.id} />)}
                </section>
            </main>
        </Fragment>
    );
};

export default Movies;