import React, { useEffect, Fragment } from 'react';
import { connect } from 'react-redux';

import { fetchArticles } from 'actions/blog';
import Article from './components/Article';
import Sidebar from 'components/Sidebar';
import Subsicribe from './components/Subsicribe';
import Pagination from 'components/Pagination';
import Container from 'components/Container';

import './blog.scss';

function Blog({ fetchArticles, isFetching, articles, error }) {

    useEffect(() => {
        fetchArticles();
    }, [fetchArticles]);

    return (
        <main className="main">
            <Container>
                <section className="blog">
                    <div className="grid">
                        <div className="content">
                            {isFetching && (<p>Loading posts...</p>)}
                            {error && (<p>Unable to display posts.</p>)}
                            {articles && (
                                <Fragment>
                                    {articles.map((article) => <Article {...article} key={article.id} />)}
                                    <Pagination />
                                </Fragment>
                            )}
                        </div>
                        <Sidebar>
                            <Subsicribe />
                        </Sidebar>
                    </div>
                </section>
            </Container>
        </main>
    );
}

const mapStateToProps = (state) => ({
    isFetching: state.blog.isFetching,
    articles: state.blog.articles,
    error: state.blog.error,
});

const mapDispatchToProps = {
    fetchArticles,
};

export default connect(mapStateToProps, mapDispatchToProps)(Blog);